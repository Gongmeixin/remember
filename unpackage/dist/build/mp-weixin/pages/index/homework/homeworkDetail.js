"use strict";const e=require("../../../common/vendor.js"),n={data:()=>({testHour:99,testMinute:99,testSecond:99,class:null,answerArr:[],total:0,currentIndex:0,userAnswer:"",userAnswerArr:[],bookId:0,volumeId:0,unitId:0,isShow:!0,tipContent:"",canBack:!1,openid:""}),onLoad(n){var s=this;e.index.getStorage({key:"openid",success(e){s.openid=e.data,console.log(s.openid)}}),console.log(n),this.class=JSON.parse(n.class);var t=this.class.split("-");console.log(this.class.split("-")),t.length>0&&(this.bookId=t[0],t.length>1&&(this.volumeId=t[1],t.length>2&&(this.unitId=t[2]))),e.index.showLoading({title:"加载中...",mask:!0}).then((e=>{console.log(e),this.getWords()}))},methods:{timeup(){e.index.showToast({title:"时间已到，答题结束",icon:"success",duration:2e3}).then((e=>{console.log(e),this.SubmitAnswer(),this.backHome()}))},getWords(){0==this.unitId?(e.index.hideLoading(),this.isShow=!1):(console.log(this.unitId),e.Ds.callFunction({name:"getWords",data:{unitId:this.unitId}}).then((n=>{console.log(n),this.answerArr=n.result.data,this.total=this.answerArr.length;var s=5*this.total;this.testSecond=s%60,this.testMinute=parseInt(s/60),this.testHour=parseInt(s/3600),console.log(this.total,this.testHour,this.testMinute,this.testSecond),e.index.hideLoading()})))},lastOne(){if(this.currentIndex>=1){let e={id:this.currentIndex+1,userWord:this.userAnswer};this.saveAnswer(e.id,e.word),this.currentIndex--,console.log(e),this.showAnswer(this.currentIndex+1)}},nextOne(){this.currentIndex<this.answerArr.length-1&&(this.currentIndex++,this.saveAnswer(this.currentIndex,this.userAnswer),this.showAnswer(this.currentIndex+1))},isInUAnswerArr_id(e){return!(this.userAnswerArr.findIndex((n=>n.id===e))<=-1)},isInUAnswerArr_word(e){return!(this.userAnswerArr.findIndex((n=>n.userWord===e))<=-1)},showAnswer(e){this.isInUAnswerArr_id(e)?this.userAnswerArr.forEach((n=>{n.id==e&&(this.userAnswer=n.userWord)})):this.userAnswer=""},saveAnswer(e,n){let s={id:e,userWord:n,unit:this.unitId,word_id:this.answerArr[e-1]._id,openid:this.openid};console.log(s.id,this.isInUAnswerArr_id(s.id)),this.isInUAnswerArr_id(s.id)||""==this.userAnswer?(console.log(s.word,this.isInUAnswerArr_word(s.word)),(!this.isInUAnswerArr_word(s.word)&&""!=this.userAnswer||this.isInUAnswerArr_id(s.id)&&""!=this.userAnswer)&&this.userAnswerArr.forEach((e=>{e.id==s.id&&(e.word=s.word,console.log("答案更新成功"))})),console.log(this.userAnswerArr)):this.isInUAnswerArr_word(s.word)&&this.isInUAnswerArr_id(s.id)||(this.userAnswerArr.push(s),console.log("新答案保存成功"))},dialogConfirm(){console.log("点击了确认"),this.canBack=!0,e.index.switchTab({url:"../index"})},dialogClose(){console.log("点击了取消")},SubmitAnswer(){e.index.showLoading({title:"正在提交...",mask:!0}).then((n=>{e.Ds.callFunction({name:"UploadAnswer",data:{userAnswer:this.userAnswerArr}}).then((n=>{console.log(n),e.index.showToast({title:"提交成功！",icon:"success",duration:2e3,mask:!0}),this.backHome()})).catch((n=>{console.log(n),e.index.showToast({title:n,icon:"none",duration:2e3,mask:!0}),this.backHome()}))}))},backHome(){e.index.hideLoading().then((n=>{e.index.showToast({title:"提交成功",icon:"success",duration:2e3}).then((n=>{e.index.switchTab({url:"../index"})}))}))},fpNumInput(e){const n=e.detail,s=/[^a-zA-Z]/g;this.$nextTick((function(){this.userAnswer=n.value.replace(s,"")}))}},onHide(){e.index.showLoading()}};if(!Array){(e.resolveComponent("uni-countdown")+e.resolveComponent("uni-section")+e.resolveComponent("uni-notice-bar")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-countdown/components/uni-countdown/uni-countdown.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const s=e._export_sfc(n,[["render",function(n,s,t,o,r,i){return{a:e.o(i.timeup),b:e.p({"show-day":!1,hour:r.testHour,minute:r.testMinute,second:r.testSecond}),c:e.p({title:"答题时间还剩",type:"line"}),d:e.f(r.answerArr,((n,s,t)=>({a:e.t(n.paraphrase),b:r.currentIndex==s,c:n._id}))),e:e.o([e=>r.userAnswer=e.detail.value,(...e)=>i.fpNumInput&&i.fpNumInput(...e)]),f:r.userAnswer,g:e.n(0==r.currentIndex?"notSelect":""),h:e.o((e=>i.lastOne())),i:e.t(r.currentIndex+1+"/"+r.total),j:e.n(r.currentIndex==r.answerArr.length-1?"notSelect":""),k:e.o((e=>i.nextOne())),l:r.currentIndex<r.answerArr.length-1,m:e.n(r.currentIndex==r.answerArr.length-1?"":"notSelect"),n:e.o((e=>i.SubmitAnswer())),o:r.currentIndex>=r.answerArr.length-1,p:r.isShow,q:e.p({"show-icon":!0,scrollable:!0,text:"暂无该单元的数据,试试别的功能吧!"}),r:e.p({title:"提示",type:"line"}),s:!r.isShow,t:e.o(i.dialogConfirm),v:e.o(i.dialogClose),w:e.p({type:"warn",cancelText:"取消",confirmText:"确认",title:"提示",content:r.tipContent}),x:e.sr("alertDialog","7a6c6c6c-4"),y:e.p({type:"dialog"})}}]]);wx.createPage(s);
